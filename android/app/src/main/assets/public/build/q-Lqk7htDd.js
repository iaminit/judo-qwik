import{b as T,q as _,u as b,l as m,p as j,C as e,k as O,i as u,j as v,_hW as f}from"./q-GWx3MS6J.js";import{p as S}from"./q-CpnnSTOF.js";import{_ as g}from"./q-DoNi8vyY.js";import{R as M,p as P}from"./q-BL5itR1-.js";import{u as E}from"./q-DZEaxapN.js";const F=T(_(()=>g(()=>import("./q-V5Ci8m9U.js").then(l=>l.m),[]),"s_RTW6trq330c")),z=()=>{const[l]=b();return l("/gestione/gallery")},L=Object.freeze(Object.defineProperty({__proto__:null,s_cljQudWUHQI:z},Symbol.toStringTag,{value:"Module"})),q=()=>{var o;const[l,n]=b();(o=n.item)!=null&&o.immagine_principale&&(l.value=S.files.getUrl(n.item,n.item.immagine_principale))},I=Object.freeze(Object.defineProperty({__proto__:null,_hW:f,s_ElUvXff76y0:q},Symbol.toStringTag,{value:"Module"})),V=l=>{const[n,o,c]=b();c.value=l,o.value=`/media/${l}`,n.value=!1;const r=document.querySelector('input[name="immagine_principale"]');r&&(r.value="")},C=Object.freeze(Object.defineProperty({__proto__:null,_hW:f,s_pJGzKB0vLHQ:V},Symbol.toStringTag,{value:"Module"})),Q=()=>{const[l]=b();return l.value=!0},N=Object.freeze(Object.defineProperty({__proto__:null,s_cTFzbkerun8:Q},Symbol.toStringTag,{value:"Module"})),A=l=>{const[n,o]=b(),c=l.target;if(c.files&&c.files[0]){o.value=null;const r=new FileReader;r.onload=i=>{var d;n.value=(d=i.target)==null?void 0:d.result},r.readAsDataURL(c.files[0])}},D=Object.freeze(Object.defineProperty({__proto__:null,_hW:f,s_nT76Ny9bV4Q:A},Symbol.toStringTag,{value:"Module"})),R=()=>{const[l]=b();l.value=!1},B=Object.freeze(Object.defineProperty({__proto__:null,_hW:f,s_rCJJ8j8SB6w:R},Symbol.toStringTag,{value:"Module"})),G=l=>{var y,k;const n=E(),o=m(!1),c=m(null),r=m(null),i=m(((y=l.item)==null?void 0:y.type)||"photo"),d=m(!1),s=m(null);j(_(()=>g(()=>Promise.resolve().then(()=>I),void 0),"s_ElUvXff76y0",[r,l]));const h=_(()=>g(()=>Promise.resolve().then(()=>D),void 0),"s_nT76Ny9bV4Q",[r,s]),w=_(()=>g(()=>Promise.resolve().then(()=>C),void 0),"s_pJGzKB0vLHQ",[d,r,s]),x=_(()=>g(()=>Promise.resolve().then(()=>W),void 0),"s_5N5GhiWKmeQ",[c,o,n,l,s]),p=t=>{if(!t)return;const a=t.match(/(?:youtube\.com\/(?:[^/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?/\s]{11})/);return a?a[1]:void 0};return e("div",null,{class:"max-w-4xl mx-auto"},[e("form",null,{class:"space-y-10 animate-in fade-in slide-in-from-bottom-4 duration-700",onSubmit$:x},[c.value&&e("div",null,{class:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-100 dark:border-red-800 rounded-2xl text-red-600 dark:text-red-400 font-bold flex items-center gap-3"},[e("span",null,null,"âš ï¸",3,null),u(t=>t.value,[c])],3,"q6_0"),e("div",null,{class:"grid grid-cols-1 lg:grid-cols-3 gap-10"},[e("div",null,{class:"space-y-4"},[e("div",null,{class:"flex items-center justify-between px-1"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest"},"Anteprima Media",3,null),i.value==="photo"&&e("button",null,{type:"button",class:"text-[10px] font-black text-pink-600 uppercase tracking-widest hover:underline",onClick$:_(()=>g(()=>Promise.resolve().then(()=>N),void 0),"s_cTFzbkerun8",[d])},"Sfoglia Libreria",3,"q6_1")],1,null),i.value==="photo"?e("div",null,{class:"relative group"},[e("div",null,{class:"aspect-square rounded-3xl bg-gray-100 dark:bg-gray-800 border-2 border-dashed border-gray-200 dark:border-gray-700 overflow-hidden flex items-center justify-center relative shadow-inner"},[r.value?e("img",null,{src:u(t=>t.value,[r]),class:"w-full h-full object-contain p-2",alt:"Preview"},null,3,"q6_2"):e("div",null,{class:"text-center p-6"},[e("span",null,{class:"text-4xl block mb-2"},"ðŸ“¸",3,null),e("span",null,{class:"text-[10px] font-black text-gray-400 uppercase tracking-widest"},"Trascina o clicca",3,null)],3,null),e("input",null,{type:"file",name:"immagine_principale",accept:"image/*",class:"absolute inset-0 opacity-0 cursor-pointer",onChange$:h},null,3,null)],1,null),r.value&&e("div",null,{class:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center rounded-3xl pointer-events-none"},e("span",null,{class:"text-white font-black uppercase tracking-widest text-xs"},"Cambia Foto",3,null),3,"q6_3")],1,"q6_4"):e("div",null,{class:"aspect-square rounded-3xl bg-gray-100 dark:bg-gray-800 border-2 border-dashed border-gray-200 dark:border-gray-700 overflow-hidden flex items-center justify-center relative shadow-inner"},(k=l.item)!=null&&k.video_link&&p(l.item.video_link)?e("img",{src:`https://img.youtube.com/vi/${p(l.item.video_link)}/hqdefault.jpg`},{class:"w-full h-full object-cover",alt:"Video Preview"},null,3,"q6_5"):e("div",null,{class:"text-center p-6"},[e("span",null,{class:"text-4xl block mb-2"},"ðŸŽ¥",3,null),e("span",null,{class:"text-[10px] font-black text-gray-400 uppercase tracking-widest"},"Anteprima Video",3,null)],3,null),1,null),e("p",null,{class:"text-[10px] text-gray-400 font-medium px-2 italic"},"Solo per Foto: .webp, .jpg. Max 5MB.",3,null)],1,null),e("div",null,{class:"lg:col-span-2 space-y-6"},[e("div",null,{class:"space-y-2"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"Titolo",3,null),e("input",null,{type:"text",name:"titolo",required:!0,value:u(t=>{var a;return(a=t.item)==null?void 0:a.titolo},[l]),placeholder:"es. Stage di Natale 2023",class:"w-full px-5 py-4 rounded-2xl bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 focus:ring-4 focus:ring-pink-500/10 focus:border-pink-500 outline-none transition-all dark:text-white font-bold"},null,3,null)],3,null),e("div",null,{class:"grid grid-cols-1 md:grid-cols-2 gap-6"},[e("div",null,{class:"space-y-2"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"Tipo Media",3,null),e("select",null,{name:"type",required:!0,value:u(t=>t.value,[i]),class:"w-full px-5 py-4 rounded-2xl bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 focus:ring-4 focus:ring-pink-500/10 focus:border-pink-500 outline-none transition-all dark:text-white font-bold appearance-none",onChange$:_(()=>g(()=>Promise.resolve().then(()=>H),void 0),"s_wksOyHGgdN0",[i])},[e("option",null,{value:"photo"},"Foto",3,null),e("option",null,{value:"video"},"Video",3,null)],3,null)],3,null),e("div",null,{class:"space-y-2"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"Data",3,null),e("input",null,{type:"date",name:"data_riferimento",value:u(t=>{var a;return(a=t.item)!=null&&a.data_riferimento?new Date(t.item.data_riferimento).toISOString().split("T")[0]:""},[l]),class:"w-full px-5 py-4 rounded-2xl bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 focus:ring-4 focus:ring-pink-500/10 focus:border-pink-500 outline-none transition-all dark:text-white font-bold"},null,3,null)],3,null)],3,null),i.value==="video"&&e("div",null,{class:"space-y-2 animate-in fade-in slide-in-from-top-2 duration-300"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"YouTube URL",3,null),e("input",null,{type:"url",name:"video_link",required:u(t=>t.value==="video",[i]),value:u(t=>{var a;return(a=t.item)==null?void 0:a.video_link},[l]),placeholder:"https://www.youtube.com/watch?v=...",class:"w-full px-5 py-4 rounded-2xl bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 focus:ring-4 focus:ring-pink-500/10 focus:border-pink-500 outline-none transition-all dark:text-white font-bold"},null,3,null)],3,"q6_6"),e("div",null,{class:"space-y-2"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"Link Esterno (opzionale)",3,null),e("input",null,{type:"url",name:"link_esterno",value:u(t=>{var a;return(a=t.item)==null?void 0:a.link_esterno},[l]),placeholder:"https://...",class:"w-full px-5 py-4 rounded-2xl bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 focus:ring-4 focus:ring-pink-500/10 focus:border-pink-500 outline-none transition-all dark:text-white font-bold"},null,3,null)],3,null),e("div",null,{class:"space-y-2"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"Descrizione",3,null),O(M,{id:"contenuto",name:"contenuto",get value(){var t;return(t=l.item)==null?void 0:t.contenuto},placeholder:"Breve descrizione dell'evento o della foto...",[v]:{id:v,name:v,value:u(t=>{var a;return(a=t.item)==null?void 0:a.contenuto},[l]),placeholder:v}},3,"q6_7")],1,null)],1,null)],1,null),e("div",null,{class:"pt-10 border-t border-gray-100 dark:border-gray-800 flex justify-end gap-4"},[e("button",null,{type:"button",class:"px-8 py-4 rounded-2xl font-bold text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800 transition-all",onClick$:_(()=>g(()=>Promise.resolve().then(()=>L),void 0),"s_cljQudWUHQI",[n])},"Annulla",3,null),e("button",null,{type:"submit",disabled:u(t=>t.value,[o]),class:"px-10 py-4 rounded-2xl bg-gray-900 dark:bg-white text-white dark:text-black font-black text-lg shadow-xl shadow-black/10 hover:transform hover:-translate-y-1 transition-all disabled:opacity-50"},u((t,a)=>t.value?"Salvataggio...":a.isNew?"Aggiungi alla Galleria":"Salva Modifiche",[o,l]),3,null)],3,null)],1,null),O(F,{get isOpen(){return d.value},onClose:_(()=>g(()=>Promise.resolve().then(()=>B),void 0),"s_rCJJ8j8SB6w",[d]),onSelect:w,[v]:{isOpen:u(t=>t.value,[d]),onSelect:v}},3,"q6_8")],1,"q6_9")},ee=Object.freeze(Object.defineProperty({__proto__:null,s_pF48z2VOmLc:G},Symbol.toStringTag,{value:"Module"})),U=l=>{const[n]=b();return n.value=l.target.value},H=Object.freeze(Object.defineProperty({__proto__:null,s_wksOyHGgdN0:U},Symbol.toStringTag,{value:"Module"})),J=async l=>{const[n,o,c,r,i]=b();l.preventDefault(),o.value=!0,n.value=null;const d=l.target,s=new FormData(d),h=p=>(p||"untitled").toLowerCase().replace(/[Ã Ã¡Ã¢Ã£Ã¤Ã¥]/g,"a").replace(/[Ã¨Ã©ÃªÃ«]/g,"e").replace(/[Ã¬Ã­Ã®Ã¯]/g,"i").replace(/[Ã²Ã³Ã´ÃµÃ¶]/g,"o").replace(/[Ã¹ÃºÃ»Ã¼]/g,"u").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").substring(0,100),w=s.get("titolo");s.get("slug")||s.append("slug",h(w));const x=s.get("type");if(x&&s.append("tags",x),i.value)try{const y=await(await fetch(`/media/${i.value}`)).blob(),k=new File([y],i.value,{type:y.type});s.set("immagine_principale",k)}catch(p){console.error("[GalleryForm] Error attaching media file:",p)}try{r.isNew?await S.collection("galleria").create(s):await S.collection("galleria").update(r.item.id,s),c("/gestione/gallery")}catch(p){n.value=P(p),window.scrollTo({top:0,behavior:"smooth"})}finally{o.value=!1}},W=Object.freeze(Object.defineProperty({__proto__:null,_hW:f,s_5N5GhiWKmeQ:J},Symbol.toStringTag,{value:"Module"}));export{F as M,f as _hW,ee as g,J as s_5N5GhiWKmeQ,q as s_ElUvXff76y0,Q as s_cTFzbkerun8,z as s_cljQudWUHQI,A as s_nT76Ny9bV4Q,G as s_pF48z2VOmLc,V as s_pJGzKB0vLHQ,R as s_rCJJ8j8SB6w,U as s_wksOyHGgdN0};
