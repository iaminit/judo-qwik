import{_ as c}from"./q-DoNi8vyY.js";import{p as u,q as d,C as e,u as m,_hW as g}from"./q-GWx3MS6J.js";import{a as _,u as h}from"./q-DZEaxapN.js";import{p as s}from"./q-CpnnSTOF.js";const y=()=>{const r=_(),t=h();return u(d(()=>c(()=>Promise.resolve().then(()=>x),void 0),"s_8lI90hNYiak",[r,t])),e("div",null,{class:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-950"},e("div",null,{class:"text-center"},[e("div",null,{class:"inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-red-600 text-white shadow-xl shadow-red-500/20 mb-6 animate-bounce"},e("span",null,{class:"text-3xl font-black"},"J",3,null),3,null),e("div",null,{class:"flex flex-col items-center gap-2"},[e("p",null,{class:"text-xl font-black text-gray-900 dark:text-white"},"Verifica in corso...",3,null),e("p",null,{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Ti stiamo portando nel Dojo.",3,null)],3,null)],3,null),3,"c3_0")},p=async()=>{const[r,t]=m(),a=r.url.searchParams.get("code");r.url.searchParams.get("state");const l=localStorage.getItem("oauth_provider");if(!l||!a){t("/gestione/login?error=invalid_callback");return}const n=JSON.parse(l),i=`${window.location.origin}/gestione/auth/callback`;try{if((await s.collection("users").authWithOAuth2Code(n.name,a,n.codeVerifier,i)).record.role!=="admin"){s.authStore.clear(),t("/gestione/login?error=Accesso negato: devi essere un amministratore.");return}localStorage.removeItem("oauth_provider"),t("/gestione")}catch(o){console.error("OAuth Error:",o),t(`/gestione/login?error=${encodeURIComponent(o.message||"Errore durante l'autenticazione OAuth2")}`)}},x=Object.freeze(Object.defineProperty({__proto__:null,_hW:g,s_8lI90hNYiak:p},Symbol.toStringTag,{value:"Module"}));export{g as _hW,p as s_8lI90hNYiak,y as s_mqHUsXn47ac};
