import{b as L,q as g,u as v,l as h,p as M,C as e,k as E,i as _,G as F,j as k,_hW as w}from"./q-GWx3MS6J.js";import{p as q}from"./q-CpnnSTOF.js";import{_ as p}from"./q-DoNi8vyY.js";import{M as j}from"./q-Lqk7htDd.js";import{R as C,p as I}from"./q-BL5itR1-.js";import{u as R}from"./q-DZEaxapN.js";const S=l=>{if(!l)return"";if(l.length===11)return l;const n=l.match(/(?:youtu\.be\/|youtube\.com\/(?:v\/|u\/\w\/|embed\/|watch\?v=))([^#&?]*)/);return n&&n[1].length===11?n[1]:""},fe=L(g(()=>p(()=>Promise.resolve().then(()=>G),void 0),"s_j16mrwetvUw")),A=l=>{const[n]=v();n.value||(l.target.src="/media/kano_non_sa.webp",l.target.classList.add("grayscale"))},D=Object.freeze(Object.defineProperty({__proto__:null,s_0CeldZsiAQE:A},Symbol.toStringTag,{value:"Module"})),V=({track:l})=>{var m,f,x,c;const[n,a,i,o]=v();l(()=>o.technique);const s=(d,b)=>{if(!b)return null;if(b.startsWith("media/"))return"/"+b;const P=b.replace(/^media\//,"");return q.files.getUrl(d,P)},y=d=>{if(!d)return null;let b=d.toLowerCase().trim().replace(/Å/g,"o").replace(/Å«/g,"u").replace(/Ä/g,"a").replace(/Ä«/g,"i").replace(/Ä“/g,"e").replace(/[\s/]+/g,"-");return b=b.replace(/tsuri-?komi/g,"tsuri-komi").replace(/seoi-?nage/g,"seoi-nage").replace(/o-?soto/g,"o-soto").replace(/o-?goshi/g,"o-goshi"),"/media/"+(b.replace(/[^-a-z0-9]/g,"").replace(/--+/g,"-").replace(/^-+|-+$/g,"")+".webp")},u=d=>d?`/media/audio/${d.toLowerCase().trim().replace(/Å/g,"o").replace(/Å«/g,"u").replace(/Ä/g,"a").replace(/Ä«/g,"i").replace(/Ä“/g,"e").replace(/[\s/-]+/g,"")}.mp3`:null;if((m=o.technique)!=null&&m.immagine_principale)i.value=s(o.technique,o.technique.immagine_principale),n.value=!1;else{const d=y((f=o.technique)==null?void 0:f.titolo);d?(i.value=d,n.value=!1):(i.value="/media/kano_non_sa.webp",n.value=!0)}(x=o.technique)!=null&&x.audio?o.technique.audio.startsWith("http")?a.value=o.technique.audio:o.technique.audio.startsWith("media/")?a.value="/"+o.technique.audio:a.value=q.files.getUrl(o.technique,o.technique.audio):(c=o.technique)!=null&&c.titolo&&(a.value=u(o.technique.titolo)),console.log("[TechniqueForm] Resolved audio URL:",a.value)},z=Object.freeze(Object.defineProperty({__proto__:null,_hW:w,s_Exsel0pO7Qs:V},Symbol.toStringTag,{value:"Module"})),Q=()=>{const[l]=v();new Audio(l.value).play().catch(a=>alert("Errore: "+a.message))},$=Object.freeze(Object.defineProperty({__proto__:null,s_uWbxyQFLYTY:Q},Symbol.toStringTag,{value:"Module"})),B=l=>{const[n,a,i]=v(),o=l.target;if(o.files&&o.files[0]){const s=o.files[0];if(s.size>5242880){n.value="L'immagine Ã¨ troppo grande. Il limite Ã¨ 5MB.",o.value="",a.value=null,window.scrollTo({top:0,behavior:"smooth"});return}n.value=null,i.value=null;const u=new FileReader;u.onload=m=>{var f;a.value=(f=m.target)==null?void 0:f.result},u.readAsDataURL(s)}},N=Object.freeze(Object.defineProperty({__proto__:null,_hW:w,s_UfsRDIy5Vkc:B},Symbol.toStringTag,{value:"Module"})),Y=l=>{var O,T;const n=R(),a=h(!1),i=h(null),o=h(null),s=h(null),y=h(!1);h();const u=h(((O=l.technique)==null?void 0:O.video_youtube)||""),m=h(!1),f=h(null),x=h([]),c=h([]);M(g(()=>p(()=>Promise.resolve().then(()=>re),void 0),"s_JNTn2R0F4qo",[c,x])),M(g(()=>p(()=>Promise.resolve().then(()=>z),void 0),"s_Exsel0pO7Qs",[y,s,o,l]));const d=g(()=>p(()=>Promise.resolve().then(()=>N),void 0),"s_UfsRDIy5Vkc",[i,o,f]),b=g(()=>p(()=>Promise.resolve().then(()=>se),void 0),"s_t2w8oL9Jq9M",[m,o,f]),P=g(()=>p(()=>Promise.resolve().then(()=>H),void 0),"s_DKpcr5Km1GQ",[s]);return e("div",null,{class:"max-w-4xl mx-auto"},[e("form",null,{class:"space-y-10 animate-in fade-in slide-in-from-bottom-4 duration-700",onSubmit$:g(()=>p(()=>Promise.resolve().then(()=>K),void 0),"s_jpuVCg0g9VE",[i,a,n,l,f])},[i.value&&e("div",null,{class:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-100 dark:border-red-800 rounded-2xl text-red-600 dark:text-red-400 font-bold flex items-center gap-3"},[e("span",null,null,"âš ï¸",3,null),_(t=>t.value,[i])],3,"Cu_0"),e("div",null,{class:"grid grid-cols-1 lg:grid-cols-3 gap-10"},[e("div",null,{class:"space-y-4"},[e("div",null,{class:"flex items-center justify-between px-1"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest"},"Immagine Tecnica",3,null),e("button",null,{type:"button",class:"text-[10px] font-black text-red-600 uppercase tracking-widest hover:underline",onClick$:g(()=>p(()=>Promise.resolve().then(()=>te),void 0),"s_CmdSiMueRYc",[m])},"Sfoglia Libreria",3,null)],3,null),e("div",null,{class:"relative group"},[e("div",null,{class:"aspect-square rounded-3xl bg-gray-100 dark:bg-gray-800 border-2 border-dashed border-gray-200 dark:border-gray-700 overflow-hidden flex items-center justify-center relative shadow-inner"},[o.value?e("img",null,{src:_(t=>t.value,[o]),class:_(t=>`w-full h-full object-contain p-2 ${t.value?"grayscale":""}`,[y]),alt:"Preview",onError$:g(()=>p(()=>Promise.resolve().then(()=>D),void 0),"s_0CeldZsiAQE",[y])},null,3,"Cu_1"):e("div",null,{class:"text-center p-6"},[e("span",null,{class:"text-4xl block mb-2"},"ðŸ“¸",3,null),e("span",null,{class:"text-[10px] font-black text-gray-400 uppercase tracking-widest"},"Trascina o clicca",3,null)],3,null),e("input",null,{type:"file",name:"immagine_principale",accept:"image/*",class:"absolute inset-0 opacity-0 cursor-pointer",onChange$:d},null,3,null)],1,null),o.value&&e("div",null,{class:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center rounded-3xl pointer-events-none"},e("span",null,{class:"text-white font-black uppercase tracking-widest text-xs"},"Cambia Foto",3,null),3,"Cu_2")],1,null),e("p",null,{class:"text-[10px] text-gray-400 font-medium px-2 italic"},"Formati consigliati: .webp, .jpg. Dimensione max: 5MB.",3,null),e("div",null,{class:"space-y-4 pt-4 border-t border-gray-100 dark:border-gray-800"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"Audio Pronuncia (MP3)",3,null),e("div",null,{class:"relative group"},e("div",null,{class:"h-[100px] rounded-3xl bg-gray-50 dark:bg-gray-800/50 border-2 border-dashed border-gray-200 dark:border-gray-700 flex flex-col items-center justify-center relative shadow-inner transition-colors group-hover:bg-gray-100 dark:group-hover:bg-gray-800"},[e("div",null,{class:"text-center"},[e("span",null,{class:"text-2xl block mb-1"},"ï¿½ï¸",3,null),e("span",null,{class:"text-[10px] font-black text-gray-400 uppercase tracking-widest"},_(t=>t.value?"Sostituisci MP3":"Carica MP3",[s]),3,null)],3,null),e("input",null,{type:"file",name:"audio",accept:"audio/mpeg, audio/mp3",class:"absolute inset-0 opacity-0 cursor-pointer z-10",onChange$:P},null,3,null)],3,null),3,null),s.value&&e("div",null,{class:"p-4 rounded-3xl bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 shadow-sm animate-in fade-in slide-in-from-top-2 duration-500"},[e("div",null,{class:"flex items-center gap-3 mb-3"},[e("span",null,{class:"text-2xl"},"ðŸŽµ",3,null),e("div",null,{class:"flex-1 min-w-0"},[e("span",null,{class:_(t=>{var r;return`text-[9px] font-black uppercase tracking-widest block ${(r=t.technique)!=null&&r.audio?"text-red-600":"text-gray-400"}`},[l])},_(t=>{var r;return(r=t.technique)!=null&&r.audio?"File Caricato":"File di Sistema"},[l]),3,null),e("p",null,{class:"text-[10px] text-gray-400 font-mono truncate"},((T=l.technique)==null?void 0:T.audio)||(s.value.startsWith("blob:")?"Nuovo File":s.value.replace("/media/audio/","")),1,null)],1,null)],1,null),e("div",null,{class:"flex items-center gap-2"},[e("audio",null,{src:_(t=>t.value,[s]),controls:!0,class:"h-10 flex-1 opacity-90",onPlay$:g(()=>p(()=>Promise.resolve().then(()=>ce),void 0),"s_KOsBPAGK4P8",[s])},null,3,s.value),e("button",null,{type:"button",class:"p-3 bg-red-600 text-white rounded-2xl shadow-lg shadow-red-500/20 hover:scale-105 active:scale-95 transition-all",title:"Play diretto",onClick$:g(()=>p(()=>Promise.resolve().then(()=>$),void 0),"s_uWbxyQFLYTY",[s])},"â–¶ï¸",3,null)],3,null)],1,"Cu_3")],1,null)],1,null),e("div",null,{class:"lg:col-span-2 space-y-6"},[e("div",null,{class:"grid grid-cols-1 md:grid-cols-2 gap-6"},[e("div",null,{class:"space-y-2"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"Nome Tecnica",3,null),e("input",null,{type:"text",name:"titolo",required:!0,value:_(t=>{var r;return(r=t.technique)==null?void 0:r.titolo},[l]),placeholder:"es. Seoi Nage",class:"w-full px-5 py-4 rounded-2xl bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 focus:ring-4 focus:ring-red-500/10 focus:border-red-500 outline-none transition-all dark:text-white font-bold"},null,3,null)],3,null),e("div",null,{class:"space-y-2"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"Tags / Gruppo",3,null),e("input",null,{type:"text",name:"tags",value:_(t=>{var r;return(r=t.technique)==null?void 0:r.tags},[l]),placeholder:"es. I Kyo, Ashi-waza",class:"w-full px-5 py-4 rounded-2xl bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 focus:ring-4 focus:ring-red-500/10 focus:border-red-500 outline-none transition-all dark:text-white font-bold"},null,3,null)],3,null),e("div",null,{class:"space-y-2"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"Categoria",3,null),e("select",null,{name:"categoria_secondaria",class:"w-full px-5 py-4 rounded-2xl bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 focus:ring-4 focus:ring-red-500/10 focus:border-red-500 outline-none transition-all dark:text-white font-bold appearance-none"},[e("option",null,{value:""},"Seleziona Categoria...",3,null),c.value.map(t=>{var r;return e("option",{value:F(t,"nome"),selected:((r=l.technique)==null?void 0:r.categoria_secondaria)===t.nome},null,`${t.nome} ${t.tipo_categoria==="sottocategoria_tecnica"?"(Sottocategoria)":""}`,1,t.id)})],1,null)],1,null)],1,null),e("div",null,{class:"grid grid-cols-1 md:grid-cols-3 gap-6"},[e("div",null,{class:"space-y-2"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"Ordine",3,null),e("input",null,{type:"number",name:"ordine",value:_(t=>{var r;return((r=t.technique)==null?void 0:r.ordine)||1},[l]),class:"w-full px-5 py-4 rounded-2xl bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 focus:ring-4 focus:ring-red-500/10 focus:border-red-500 outline-none transition-all dark:text-white font-bold"},null,3,null)],3,null),e("div",null,{class:"space-y-2"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"Grado Richiesto",3,null),e("select",null,{name:"livello",class:"w-full px-5 py-4 rounded-2xl bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 focus:ring-4 focus:ring-red-500/10 focus:border-red-500 outline-none transition-all dark:text-white font-bold appearance-none"},[e("option",null,{value:"1"},"Base (1)",3,null),x.value.map(t=>{var r;return e("option",{value:F(t,"grado"),selected:Number((r=l.technique)==null?void 0:r.livello)===t.grado},null,t.nome_completo,1,t.id)})],1,null)],1,null),e("div",null,{class:"space-y-2"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"YouTube Link",3,null),S(u.value)&&e("div",null,{class:"mb-4 rounded-2xl overflow-hidden border border-gray-100 dark:border-gray-800 bg-gray-50 dark:bg-black/20 aspect-video relative group/yt"},e("iframe",{src:`https://www.youtube.com/embed/${S(u.value)}`},{class:"w-full h-full",title:"YouTube Preview",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullscreen:!0},null,3,null),1,"Cu_4"),e("input",null,{type:"text",name:"video_link",value:_(t=>t.value,[u]),placeholder:"Link YouTube",class:"w-full px-5 py-4 rounded-2xl bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 focus:ring-4 focus:ring-red-500/10 focus:border-red-500 outline-none transition-all dark:text-white font-bold",onInput$:g(()=>p(()=>Promise.resolve().then(()=>ne),void 0),"s_QZYmGDJIwpk",[u])},null,3,null)],1,null)],1,null),e("div",null,{class:"space-y-2"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"Contenuto / Descrizione",3,null),E(C,{id:"contenuto",name:"contenuto",get value(){var t;return(t=l.technique)==null?void 0:t.contenuto},placeholder:"Descrivi la tecnica, i suoi principi e punti chiave...",[k]:{id:k,name:k,value:_(t=>{var r;return(r=t.technique)==null?void 0:r.contenuto},[l]),placeholder:k}},3,"Cu_5")],1,null)],1,null)],1,null),e("div",null,{class:"pt-10 border-t border-gray-100 dark:border-gray-800 flex justify-end gap-4"},[e("button",null,{type:"button",class:"px-8 py-4 rounded-2xl font-bold text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800 transition-all",onClick$:g(()=>p(()=>Promise.resolve().then(()=>J),void 0),"s_LNBxBDEwgFI",[n])},"Annulla",3,null),e("button",null,{type:"submit",disabled:_(t=>t.value,[a]),class:"px-10 py-4 rounded-2xl bg-gray-900 dark:bg-white text-white dark:text-black font-black text-lg shadow-xl shadow-black/10 hover:transform hover:-translate-y-1 transition-all disabled:opacity-50"},_((t,r)=>t.value?"Salvataggio...":r.isNew?"Crea Tecnica":"Salva Modifiche",[a,l]),3,null)],3,null)],1,null),E(j,{get isOpen(){return m.value},onClose:g(()=>p(()=>Promise.resolve().then(()=>ee),void 0),"s_01RMnqWLqG0",[m]),onSelect:b,[k]:{isOpen:_(t=>t.value,[m]),onSelect:k}},3,"Cu_6")],1,"Cu_7")},G=Object.freeze(Object.defineProperty({__proto__:null,s_j16mrwetvUw:Y},Symbol.toStringTag,{value:"Module"})),U=async l=>{const[n,a,i,o,s]=v();l.preventDefault(),a.value=!0,n.value=null;const y=l.target,u=new FormData(y),m=c=>(c||"untitled").toLowerCase().replace(/[Ã Ã¡Ã¢Ã£Ã¤Ã¥]/g,"a").replace(/[Ã¨Ã©ÃªÃ«]/g,"e").replace(/[Ã¬Ã­Ã®Ã¯]/g,"i").replace(/[Ã²Ã³Ã´ÃµÃ¶]/g,"o").replace(/[Ã¹ÃºÃ»Ã¼]/g,"u").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").substring(0,100),f=u.get("titolo");u.get("slug")||u.append("slug",m(f));const x=u.get("video_link");if(x){const c=S(x);c&&u.append("video_id",c)}if(s.value)try{const d=await(await fetch(`/media/${s.value}`)).blob(),b=new File([d],s.value,{type:d.type});u.set("immagine_principale",b)}catch(c){console.error("[TechniqueForm] Error attaching media file:",c)}try{o.isNew?await q.collection("tecniche").create(u):await q.collection("tecniche").update(o.technique.id,u),i("/gestione/tecniche")}catch(c){n.value=I(c),window.scrollTo({top:0,behavior:"smooth"})}finally{a.value=!1}},K=Object.freeze(Object.defineProperty({__proto__:null,_hW:w,s_jpuVCg0g9VE:U},Symbol.toStringTag,{value:"Module"})),W=()=>{const[l]=v();return l("/gestione/tecniche")},J=Object.freeze(Object.defineProperty({__proto__:null,s_LNBxBDEwgFI:W},Symbol.toStringTag,{value:"Module"})),Z=l=>{const[n]=v(),a=l.target;if(a.files&&a.files[0]){const i=URL.createObjectURL(a.files[0]);n.value=i,console.log("[TechniqueForm] New audio preview URL:",i)}},H=Object.freeze(Object.defineProperty({__proto__:null,_hW:w,s_DKpcr5Km1GQ:Z},Symbol.toStringTag,{value:"Module"})),X=()=>{const[l]=v();l.value=!1},ee=Object.freeze(Object.defineProperty({__proto__:null,_hW:w,s_01RMnqWLqG0:X},Symbol.toStringTag,{value:"Module"})),le=()=>{const[l]=v();return l.value=!0},te=Object.freeze(Object.defineProperty({__proto__:null,s_CmdSiMueRYc:le},Symbol.toStringTag,{value:"Module"})),oe=l=>{const[n]=v();n.value=l.target.value},ne=Object.freeze(Object.defineProperty({__proto__:null,s_QZYmGDJIwpk:oe},Symbol.toStringTag,{value:"Module"})),ae=async()=>{const[l,n]=v();try{const a=await q.collection("livelli_dan").getFullList({sort:"ordine"});n.value=a;const i=await q.collection("categorie").getFullList({filter:'tipo_categoria = "tecnica" || tipo_categoria = "sottocategoria_tecnica"',sort:"ordine"});l.value=i}catch(a){console.error("[TechniqueForm] Error fetching lookup data:",a)}},re=Object.freeze(Object.defineProperty({__proto__:null,_hW:w,s_JNTn2R0F4qo:ae},Symbol.toStringTag,{value:"Module"})),ie=l=>{const[n,a,i]=v();i.value=l,a.value=`/media/${l}`,n.value=!1;const o=document.querySelector('input[name="immagine_principale"]');o&&(o.value="")},se=Object.freeze(Object.defineProperty({__proto__:null,_hW:w,s_t2w8oL9Jq9M:ie},Symbol.toStringTag,{value:"Module"})),ue=()=>{const[l]=v();return console.log("[TechniqueForm] Playing:",l.value)},ce=Object.freeze(Object.defineProperty({__proto__:null,s_KOsBPAGK4P8:ue},Symbol.toStringTag,{value:"Module"}));export{fe as T,w as _hW,X as s_01RMnqWLqG0,A as s_0CeldZsiAQE,le as s_CmdSiMueRYc,Z as s_DKpcr5Km1GQ,V as s_Exsel0pO7Qs,ae as s_JNTn2R0F4qo,ue as s_KOsBPAGK4P8,W as s_LNBxBDEwgFI,oe as s_QZYmGDJIwpk,B as s_UfsRDIy5Vkc,Y as s_j16mrwetvUw,U as s_jpuVCg0g9VE,ie as s_t2w8oL9Jq9M,Q as s_uWbxyQFLYTY};
