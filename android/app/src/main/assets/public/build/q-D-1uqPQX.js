import{u as h,l as O,C as e,k as J,q as f,i as u,j as y,_hW as E}from"./q-GWx3MS6J.js";import{_ as v}from"./q-DoNi8vyY.js";import{M as z}from"./q-Lqk7htDd.js";import{R as L,p as j}from"./q-BL5itR1-.js";import{C,p as M}from"./q-CpnnSTOF.js";import{u as F}from"./q-DZEaxapN.js";const x="https://judo.1ms.it",oe=new C(x);typeof console<"u"&&console.log("[PocketBase] Initialized with URL:",x);const D=(l,s,o)=>o?o.startsWith("http")?o:o.startsWith("/media")?`${x}${o}`:`${x}/api/files/${l}/${s}/${o}`:"",ae=l=>l?l.startsWith("http")?l:l.startsWith("/")?`${x}${l}`:`${x}/${l}`:"",R=()=>{const[l]=h();l.value=!1},$=Object.freeze(Object.defineProperty({__proto__:null,_hW:E,s_eSzeQXAnEgA:R},Symbol.toStringTag,{value:"Module"})),N=()=>{const[l]=h();return l("/gestione/bacheca")},U=Object.freeze(Object.defineProperty({__proto__:null,s_0CSBNJNbywo:N},Symbol.toStringTag,{value:"Module"})),V=l=>{const[s,o,c]=h();c.value=l,s.value=`/media/${l}`,o.value=!1;const r=document.querySelector('input[name="immagine_principale"]');r&&(r.value="")},B=Object.freeze(Object.defineProperty({__proto__:null,_hW:E,s_wl1CxUJTVyE:V},Symbol.toStringTag,{value:"Module"})),q=()=>{const[l]=h();return l.value=!0},G=Object.freeze(Object.defineProperty({__proto__:null,s_9GdzDqKyl4U:q},Symbol.toStringTag,{value:"Module"})),K=l=>{var A,_,k,S,m,b;const s=F(),o=O(!1),c=O(null),r=O(null),i=O(!1),a=O(null),p=f(()=>v(()=>Promise.resolve().then(()=>W),void 0),"s_GS3F4hFhyYw",[c,o,l,a]),w=f(()=>v(()=>Promise.resolve().then(()=>Y),void 0),"s_qNLcIIi0zsQ",[c,r,a]),g=f(()=>v(()=>Promise.resolve().then(()=>B),void 0),"s_wl1CxUJTVyE",[r,i,a]);return e("div",null,{class:"max-w-5xl mx-auto"},[e("form",null,{id:"post-form","preventdefault:submit":!0,class:"space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-700",onSubmit$:p},[c.value&&e("div",null,{class:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-100 dark:border-red-800 rounded-2xl text-red-600 dark:text-red-400 font-bold flex items-center gap-3"},[e("span",null,null,"âš ï¸",3,null),u(t=>t.value,[c])],3,"hJ_0"),e("div",null,{class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},[e("div",null,{class:"lg:col-span-2 space-y-6"},[e("div",null,{class:"space-y-2"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"Titolo della News",3,null),e("input",null,{type:"text",name:"titolo",required:!0,value:u(t=>{var n;return(n=t.post)==null?void 0:n.titolo},[l]),placeholder:"es. Stage Tecnico di Primavera",class:"w-full px-6 py-4 rounded-2xl bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 focus:ring-4 focus:ring-orange-500/10 focus:border-orange-500 outline-none transition-all dark:text-white font-black uppercase tracking-tight"},null,3,null)],3,null),e("div",null,{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[e("div",null,{class:"space-y-2"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"AttivitÃ ",3,null),e("select",null,{name:"tags",class:"w-full px-5 py-4 rounded-2xl bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 focus:ring-4 focus:ring-orange-500/10 focus:border-orange-500 outline-none transition-all dark:text-white font-bold"},[e("option",null,{value:"",selected:u(t=>{var n;return!((n=t.post)!=null&&n.tags)},[l])},"Generale",3,null),e("option",null,{value:"JUDO",selected:u(t=>{var n;return((n=t.post)==null?void 0:n.tags)==="JUDO"},[l])},"Judo",3,null),e("option",null,{value:"BJJ",selected:u(t=>{var n;return((n=t.post)==null?void 0:n.tags)==="BJJ"},[l])},"BJJ",3,null),e("option",null,{value:"JJ",selected:u(t=>{var n;return((n=t.post)==null?void 0:n.tags)==="JJ"},[l])},"JJ",3,null),e("option",null,{value:"KRAV MAGA",selected:u(t=>{var n;return((n=t.post)==null?void 0:n.tags)==="KRAV MAGA"},[l])},"Krav Maga",3,null)],3,null)],3,null),e("div",null,{class:"space-y-2"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"Data Pubblicazione",3,null),e("input",null,{type:"datetime-local",name:"data_riferimento",required:!0,value:u(t=>{var n;return typeof((n=t.post)==null?void 0:n.data_riferimento)=="string"?t.post.data_riferimento.substring(0,16).replace(" ","T"):new Date().toISOString().substring(0,16)},[l]),class:"w-full px-5 py-4 rounded-2xl bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 focus:ring-4 focus:ring-orange-500/10 focus:border-orange-500 outline-none transition-all dark:text-white font-bold"},null,3,null)],3,null)],3,null),e("div",null,{class:"space-y-2"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"Contenuto",3,null),J(L,{name:"contenuto",id:"contenuto",get value(){var t;return(t=l.post)==null?void 0:t.contenuto},placeholder:"Scrivi qui la news...",[y]:{name:y,id:y,value:u(t=>{var n;return(n=t.post)==null?void 0:n.contenuto},[l]),placeholder:y}},3,"hJ_1")],1,null)],1,null),e("div",null,{class:"space-y-6"},[e("div",null,{class:"space-y-4"},[e("div",null,{class:"flex items-center justify-between px-1"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest"},"Immagine di Copertina",3,null),e("button",null,{type:"button",class:"text-[10px] font-black text-orange-600 uppercase tracking-widest hover:underline",onClick$:f(()=>v(()=>Promise.resolve().then(()=>G),void 0),"s_9GdzDqKyl4U",[i])},"Sfoglia Libreria",3,null)],3,null),e("div",null,{class:"relative group aspect-video rounded-3xl overflow-hidden bg-gray-100 dark:bg-gray-800 border-2 border-dashed border-gray-200 dark:border-gray-700"},[r.value||(A=l.post)!=null&&A.immagine_principale&&!l.isNew?e("img",{src:r.value||((k=(_=l.post)==null?void 0:_.immagine_principale)!=null&&k.startsWith("media/")?"/"+l.post.immagine_principale:D((S=l.post)==null?void 0:S.collectionId,(m=l.post)==null?void 0:m.id,(b=l.post)==null?void 0:b.immagine_principale))},{alt:"Preview",class:"w-full h-full object-cover",onError$:f(()=>v(()=>import("./q-L94jJj65.js"),[]),"s_hKAXb54Ltak")},null,3,"hJ_2"):e("div",null,{class:"w-full h-full flex flex-col items-center justify-center text-gray-400"},[e("span",null,{class:"text-4xl mb-2"},"ðŸ–¼ï¸",3,null),e("span",null,{class:"text-[10px] font-black uppercase tracking-widest"},"Seleziona Immagine",3,null)],3,null),e("input",null,{type:"file",name:"immagine_principale",accept:"image/*",class:"absolute inset-0 opacity-0 cursor-pointer",onInput$:w},null,3,null)],1,null)],1,null),e("div",null,{class:"space-y-2"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"Video Link (YouTube o URL)",3,null),e("input",null,{type:"text",name:"video_link",value:u(t=>{var n;return(n=t.post)==null?void 0:n.video_link},[l]),placeholder:"es. https://youtu.be/...",class:"w-full px-5 py-4 rounded-2xl bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 focus:ring-4 focus:ring-orange-500/10 focus:border-orange-500 outline-none transition-all dark:text-white font-medium"},null,3,null)],3,null),e("div",null,{class:"space-y-2"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"Link Esterno (Opzionale)",3,null),e("input",null,{type:"text",name:"link_esterno",value:u(t=>{var n;return(n=t.post)==null?void 0:n.link_esterno},[l]),placeholder:"es. https://fijlkam.it/gara...",class:"w-full px-5 py-4 rounded-2xl bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 focus:ring-4 focus:ring-orange-500/10 focus:border-orange-500 outline-none transition-all dark:text-white font-medium"},null,3,null)],3,null),e("div",null,{class:"space-y-2"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"Data Scadenza (Auto-archiviazione)",3,null),e("input",null,{type:"datetime-local",name:"data_fine",value:u(t=>{var n;return typeof((n=t.post)==null?void 0:n.data_fine)=="string"?t.post.data_fine.substring(0,16).replace(" ","T"):""},[l]),class:"w-full px-5 py-4 rounded-2xl bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 focus:ring-4 focus:ring-orange-500/10 focus:border-orange-500 outline-none transition-all dark:text-white font-bold"},null,3,null)],3,null)],1,null)],1,null),e("div",null,{class:"pt-10 border-t border-gray-100 dark:border-gray-800 flex justify-end gap-4"},[e("button",null,{type:"button",class:"px-8 py-4 rounded-2xl font-bold text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800 transition-all",onClick$:f(()=>v(()=>Promise.resolve().then(()=>U),void 0),"s_0CSBNJNbywo",[s])},"Annulla",3,null),e("button",null,{type:"button",disabled:u(t=>t.value,[o]),class:"px-10 py-4 rounded-2xl bg-orange-600 text-white font-black text-lg shadow-xl shadow-orange-500/20 hover:transform hover:-translate-y-1 transition-all disabled:opacity-50",onClick$:p},u((t,n)=>t.value?"In corso...":n.isNew?"Pubblica News":"Salva Modifiche",[o,l]),3,null)],3,null)],1,null),J(z,{get isOpen(){return i.value},onClose:f(()=>v(()=>Promise.resolve().then(()=>$),void 0),"s_eSzeQXAnEgA",[i]),onSelect:g,[y]:{isOpen:u(t=>t.value,[i]),onSelect:y}},3,"hJ_3")],1,"hJ_4")},re=Object.freeze(Object.defineProperty({__proto__:null,s_0J3LsTZOlIw:K},Symbol.toStringTag,{value:"Module"})),Q=async()=>{var t,n;const[l,s,o,c]=h();console.log("[Admin] Form SUBMIT triggered"),s.value=!0,l.value=null;const r=document.getElementById("post-form");if(!r){alert("Errore: Form non trovato nel DOM"),s.value=!1;return}const i=new FormData(r),a=new FormData,p=(t=i.get("titolo"))==null?void 0:t.trim();if(!p){alert("Il campo TITOLO Ã¨ obbligatorio."),s.value=!1;return}a.append("titolo",p);const w=d=>(d||"untitled").toLowerCase().replace(/[Ã Ã¡Ã¢Ã£Ã¤Ã¥]/g,"a").replace(/[Ã¨Ã©ÃªÃ«]/g,"e").replace(/[Ã¬Ã­Ã®Ã¯]/g,"i").replace(/[Ã²Ã³Ã´ÃµÃ¶]/g,"o").replace(/[Ã¹ÃºÃ»Ã¼]/g,"u").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").substring(0,100);a.append("slug",w(p));const g=i.get("contenuto");console.log("[Admin] Sending content:",g),a.append("contenuto",g||"");const A=i.get("tags");a.append("tags",A||"GENERALE");let _=i.get("data_riferimento");if(_&&_.includes("T")&&(_=_.replace("T"," ")+":00"),!_){alert("Il campo DATA Ã¨ obbligatorio."),s.value=!1;return}a.append("data_riferimento",_);const k=i.get("video_link");k&&a.append("video_link",k);const S=i.get("link_esterno");S&&a.append("link_esterno",S);let m=i.get("data_fine");m&&m.includes("T")&&(m=m.replace("T"," ")+":00",a.append("data_fine",m));const b=r.querySelector('input[name="immagine_principale"]');if((n=b==null?void 0:b.files)!=null&&n[0])console.log("[Admin] Adding new cover image:",b.files[0].name),a.append("immagine_principale",b.files[0]);else if(c.value){console.log("[Admin] Attaching existing media:",c.value);try{const T=await(await fetch(`/media/${c.value}`)).blob(),P=new File([T],c.value,{type:T.type});a.append("immagine_principale",P)}catch(d){console.error("[Admin] Error attaching media file:",d)}}if(!M.authStore.isValid){alert("Attenzione: Sessione non valida. Effettua nuovamente il login."),s.value=!1;return}try{if(o.isNew){await M.collection("bacheca").create(a);try{const d=(g==null?void 0:g.replace(/<[^>]*>/g,""))||"",T=d.length>150?d.substring(0,150)+"...":d,I=await(await fetch("/api/email/post-notification",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:p,author:"Admin",excerpt:T||"Nessun contenuto disponibile"})})).json();I.success?console.log("[PostForm] âœ‰ï¸ Email notification sent successfully"):console.warn("[PostForm] âš ï¸ Email notification failed:",I.error)}catch(d){console.error("[PostForm] âš ï¸ Error sending email notification:",d)}}else await M.collection("bacheca").update(o.post.id,a);window.location.href="/gestione/bacheca"}catch(d){l.value=j(d),window.scrollTo({top:0,behavior:"smooth"})}finally{s.value=!1}},W=Object.freeze(Object.defineProperty({__proto__:null,_hW:E,s_GS3F4hFhyYw:Q},Symbol.toStringTag,{value:"Module"})),X=l=>{const[s,o,c]=h(),r=l.target;if(r.files&&r.files[0]){const i=r.files[0];if(i.size>5242880){s.value="L'immagine Ã¨ troppo grande. Il limite Ã¨ 5MB.",r.value="",o.value=null,window.scrollTo({top:0,behavior:"smooth"});return}s.value=null,c.value=null;const p=new FileReader;p.onload=w=>{var g;o.value=(g=w.target)==null?void 0:g.result},p.readAsDataURL(i)}},Y=Object.freeze(Object.defineProperty({__proto__:null,_hW:E,s_qNLcIIi0zsQ:X},Symbol.toStringTag,{value:"Module"}));export{E as _hW,ae as a,re as b,D as g,oe as p,N as s_0CSBNJNbywo,K as s_0J3LsTZOlIw,q as s_9GdzDqKyl4U,Q as s_GS3F4hFhyYw,R as s_eSzeQXAnEgA,X as s_qNLcIIi0zsQ,V as s_wl1CxUJTVyE};
