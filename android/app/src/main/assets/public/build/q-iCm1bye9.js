import{u as p,B as S,l as b,k as v,C as l,i,q as g,j as _,F as O,_hW as f}from"./q-GWx3MS6J.js";import{_ as m}from"./q-DoNi8vyY.js";import{M}from"./q-Lqk7htDd.js";import{R as w}from"./q-BL5itR1-.js";import{p as k}from"./q-CpnnSTOF.js";import{u as P}from"./q-DZEaxapN.js";const j=()=>{const[e]=p();return e("/gestione/storia")},E=Object.freeze(Object.defineProperty({__proto__:null,s_Xa1GHBtPrDE:j},Symbol.toStringTag,{value:"Module"})),A=e=>{const[s,r,n]=p();n.value=e,s.value=`/media/${e}`,r.value=!1;const o=document.querySelector('input[name="immagine_principale"]');o&&(o.value="")},F=Object.freeze(Object.defineProperty({__proto__:null,_hW:f,s_cud7CadhETg:A},Symbol.toStringTag,{value:"Module"})),T=()=>{const[e]=p();e.value=!1},C=Object.freeze(Object.defineProperty({__proto__:null,_hW:f,s_7gegPCVM7JI:T},Symbol.toStringTag,{value:"Module"})),L=e=>{var d;S();const s=P(),r=b(!1),n=b(null),o=b((d=e.item)!=null&&d.immagine_principale?e.item.immagine_principale.startsWith("media/")?"/"+e.item.immagine_principale:k.files.getUrl(e.item,e.item.immagine_principale):null),c=b(!1),y=b(null),u=g(()=>m(()=>Promise.resolve().then(()=>R),void 0),"s_0Frvy0g9y8Y",[n,r,s,e,y]),x=g(()=>m(()=>Promise.resolve().then(()=>D),void 0),"s_00nLsS90e58",[o,y]),h=g(()=>m(()=>Promise.resolve().then(()=>F),void 0),"s_cud7CadhETg",[o,c,y]);return v(O,{children:[l("form",null,{class:"bg-white dark:bg-gray-900 rounded-3xl p-8 border border-gray-100 dark:border-gray-800 shadow-sm space-y-6",onSubmit$:u},[n.value&&l("div",null,{class:"p-4 bg-red-50 text-red-600 rounded-xl border border-red-100 font-bold"},i(t=>t.value,[n]),3,"9A_0"),l("div",null,{class:"grid grid-cols-1 gap-6"},[l("div",null,{class:"space-y-2"},[l("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"Titolo",3,null),l("input",null,{type:"text",name:"titolo",value:i(t=>{var a;return((a=t.item)==null?void 0:a.titolo)||""},[e]),required:!0,class:"w-full px-5 py-4 rounded-2xl bg-gray-50 dark:bg-gray-800 border-none font-bold text-gray-900 dark:text-white"},null,3,null)],3,null),e.type==="info"&&l("div",null,{class:"space-y-2"},[l("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"Sottotitolo",3,null),l("input",null,{type:"text",name:"titolo_secondario",value:i(t=>{var a;return((a=t.item)==null?void 0:a.titolo_secondario)||""},[e]),class:"w-full px-5 py-4 rounded-2xl bg-gray-50 dark:bg-gray-800 border-none font-bold text-gray-900 dark:text-white"},null,3,null)],3,"9A_1"),e.type==="timeline"&&l("div",null,{class:"space-y-2"},[l("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"Anno",3,null),l("input",null,{type:"number",name:"anno",value:i(t=>{var a;return((a=t.item)==null?void 0:a.anno)||""},[e]),required:!0,class:"w-full px-5 py-4 rounded-2xl bg-gray-50 dark:bg-gray-800 border-none font-bold text-gray-900 dark:text-white"},null,3,null)],3,"9A_2"),e.type==="info"&&l("div",null,{class:"space-y-6"},[l("div",null,{class:"space-y-2"},[l("div",null,{class:"flex items-center justify-between px-1"},[l("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest"},"Immagine (Opzionale)",3,null),l("button",null,{type:"button",class:"text-[10px] font-black text-orange-600 uppercase tracking-widest hover:underline",onClick$:g(()=>m(()=>Promise.resolve().then(()=>q),void 0),"s_q8OOWok02co",[c])},"Sfoglia Libreria",3,null)],3,null),l("input",null,{type:"file",name:"immagine_principale",accept:"image/*",class:"w-full px-5 py-4 rounded-2xl bg-gray-50 dark:bg-gray-800 border-none font-medium text-gray-500",onChange$:x},null,3,null)],3,null),o.value&&l("div",null,{class:"w-full h-64 rounded-3xl overflow-hidden bg-gray-100 dark:bg-gray-800 border border-gray-100 dark:border-gray-700"},l("img",null,{src:i(t=>t.value,[o]),class:"w-full h-full object-contain p-4",alt:"Preview"},null,3,null),3,"9A_3")],1,"9A_4"),e.type==="info"?l("div",null,{class:"space-y-2"},[l("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"Contenuto (HTML)",3,null),v(w,{name:"contenuto",id:"contenuto_info",get value(){var t;return((t=e.item)==null?void 0:t.contenuto)||""},[_]:{name:_,id:_,value:i(t=>{var a;return((a=t.item)==null?void 0:a.contenuto)||""},[e])}},3,"9A_5")],1,"9A_6"):l("div",null,{class:"space-y-2"},[l("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"Descrizione",3,null),v(w,{name:"contenuto",id:"contenuto_timeline",get value(){var t;return((t=e.item)==null?void 0:t.contenuto)||""},[_]:{name:_,id:_,value:i(t=>{var a;return((a=t.item)==null?void 0:a.contenuto)||""},[e])}},3,"9A_7")],1,null)],1,null),l("div",null,{class:"pt-6 flex gap-4"},[l("button",null,{type:"submit",disabled:i(t=>t.value,[r]),class:"px-10 py-4 bg-orange-600 text-white font-black rounded-2xl shadow-xl shadow-orange-500/20 hover:scale-105 transition-all disabled:opacity-50"},i(t=>t.value?"Salvataggio...":"Salva Elemento",[r]),3,null),l("button",null,{type:"button",class:"px-10 py-4 bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 font-black rounded-2xl hover:bg-gray-200 transition-all",onClick$:g(()=>m(()=>Promise.resolve().then(()=>E),void 0),"s_Xa1GHBtPrDE",[s])},"Annulla",3,null)],3,null)],1,null),v(M,{get isOpen(){return c.value},onClose:g(()=>m(()=>Promise.resolve().then(()=>C),void 0),"s_7gegPCVM7JI",[c]),onSelect:h,[_]:{isOpen:i(t=>t.value,[c]),onSelect:_}},3,"9A_8")]},1,"9A_9")},G=Object.freeze(Object.defineProperty({__proto__:null,s_jmc6IZHAS5U:L},Symbol.toStringTag,{value:"Module"})),I=e=>{const[s,r]=p(),n=e.target;n.files&&n.files[0]&&(r.value=null,s.value=URL.createObjectURL(n.files[0]))},D=Object.freeze(Object.defineProperty({__proto__:null,_hW:f,s_00nLsS90e58:I},Symbol.toStringTag,{value:"Module"})),z=async e=>{const[s,r,n,o,c]=p();e.preventDefault(),r.value=!0,s.value=null;const y=e.target,u=new FormData(y),x=d=>(d||"untitled").toLowerCase().replace(/[àáâãäå]/g,"a").replace(/[èéêë]/g,"e").replace(/[ìíîï]/g,"i").replace(/[òóôõö]/g,"o").replace(/[ùúûü]/g,"u").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").substring(0,100),h=u.get("titolo");if(u.get("slug")||u.append("slug",x(h)),o.type==="info"&&u.append("tags","articolo"),c.value)try{const t=await(await fetch(`/media/${c.value}`)).blob(),a=new File([t],c.value,{type:t.type});u.set("immagine_principale",a)}catch(d){console.error("[HistoryForm] Error attaching media file:",d)}try{o.isNew?await k.collection("storia").create(u):await k.collection("storia").update(o.item.id,u),n("/gestione/storia")}catch(d){s.value=d.message||"Errore durante il salvataggio"}finally{r.value=!1}},R=Object.freeze(Object.defineProperty({__proto__:null,_hW:f,s_0Frvy0g9y8Y:z},Symbol.toStringTag,{value:"Module"})),V=()=>{const[e]=p();return e.value=!0},q=Object.freeze(Object.defineProperty({__proto__:null,s_q8OOWok02co:V},Symbol.toStringTag,{value:"Module"}));export{f as _hW,G as h,I as s_00nLsS90e58,z as s_0Frvy0g9y8Y,T as s_7gegPCVM7JI,j as s_Xa1GHBtPrDE,A as s_cud7CadhETg,L as s_jmc6IZHAS5U,V as s_q8OOWok02co};
