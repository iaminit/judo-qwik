import{u,l as c,p as f,q as s,C as e,i,G as x,_hW as m}from"./q-GWx3MS6J.js";import{p as g}from"./q-CpnnSTOF.js";import{_ as d}from"./q-DoNi8vyY.js";const y=({track:t})=>{const[o,n]=u();t(()=>n.isOpen),n.isOpen&&o()},h=Object.freeze(Object.defineProperty({__proto__:null,_hW:m,s_QMOW0Dg8Hh4:y},Symbol.toStringTag,{value:"Module"})),k=t=>{const[o]=u();return o.value=t.target.value},C=Object.freeze(Object.defineProperty({__proto__:null,s_9rGVhqV152A:k},Symbol.toStringTag,{value:"Module"})),M=async()=>{const[t,o]=u();t.value=!0;try{const n=await g.collection("users").getFullList({sort:"name"});o.value=n}catch(n){console.error("Error fetching users:",n)}finally{t.value=!1}},w=Object.freeze(Object.defineProperty({__proto__:null,_hW:m,s_r0HPMCmu084:M},Symbol.toStringTag,{value:"Module"})),O=()=>{const[t,o]=u();return t(o.email,o.name)},S=Object.freeze(Object.defineProperty({__proto__:null,s_c23VCCMQ7tY:O},Symbol.toStringTag,{value:"Module"})),j=t=>{const o=c([]),n=c(!0),r=c(!1),a=c("");f(s(()=>d(()=>Promise.resolve().then(()=>h),void 0),"s_QMOW0Dg8Hh4",[s(()=>d(()=>Promise.resolve().then(()=>w),void 0),"s_r0HPMCmu084",[n,o]),t]));const p=s(()=>d(()=>Promise.resolve().then(()=>E),void 0),"s_CttFvaEj9e0",[r,t]);if(!t.isOpen||!t.task)return null;const b=o.value.filter(l=>(l.name||"").toLowerCase().includes(a.value.toLowerCase())||l.email.toLowerCase().includes(a.value.toLowerCase()));return e("div",null,{class:"fixed inset-0 z-[60] flex items-center justify-center p-4"},[e("div",{onClick$:t.onClose$},{class:"absolute inset-0 bg-black/60 backdrop-blur-sm"},null,2,null),e("div",null,{class:"relative bg-white dark:bg-gray-900 rounded-3xl shadow-2xl max-w-md w-full max-h-[80vh] flex flex-col overflow-hidden animate-in zoom-in-95 duration-200"},[e("div",null,{class:"p-6 border-b border-gray-100 dark:border-gray-800 bg-blue-50/50 dark:bg-blue-900/10"},[e("h2",null,{class:"text-xl font-black text-gray-900 dark:text-white flex items-center gap-2"},[e("span",null,null,"üìß",3,null)," Sollecita Collaboratore"],3,null),e("p",null,{class:"text-xs text-gray-500 mt-1"},"Seleziona un utente per inviare un promemoria per:",3,null),e("p",null,{class:"text-sm font-bold text-blue-600 dark:text-blue-400 mt-0.5 line-clamp-1"},['"',i(l=>l.task.titolo,[t]),'"'],3,null)],3,null),e("div",null,{class:"p-4 border-b border-gray-100 dark:border-gray-800"},e("input",null,{type:"text",placeholder:"Cerca per nome o email...",value:i(l=>l.value,[a]),class:"w-full px-4 py-2.5 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-500 transition-all",onInput$:s(()=>d(()=>Promise.resolve().then(()=>C),void 0),"s_9rGVhqV152A",[a])},null,3,null),3,null),e("div",null,{class:"flex-1 overflow-y-auto p-4 space-y-2 custom-scrollbar"},n.value?e("div",null,{class:"flex flex-col gap-2"},[1,2,3,4].map(l=>e("div",null,{class:"h-12 bg-gray-50 dark:bg-gray-800 rounded-xl animate-pulse"},null,3,l)),1,"je_0"):b.length>0?b.map(l=>e("button",{onClick$:s(()=>d(()=>Promise.resolve().then(()=>S),void 0),"s_c23VCCMQ7tY",[p,l])},{disabled:i(v=>v.value,[r]),class:"w-full flex items-center gap-3 p-3 rounded-xl border border-gray-100 dark:border-gray-800 hover:border-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all group disabled:opacity-50 disabled:cursor-not-allowed"},[e("div",null,{class:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white font-bold text-sm shadow-sm"},(l.name||l.email)[0].toUpperCase(),1,null),e("div",null,{class:"flex-1 text-left"},[e("p",null,{class:"text-sm font-bold text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors"},l.name||"Utente senza nome",1,null),e("p",null,{class:"text-[10px] text-gray-500 dark:text-gray-400"},x(l,"email"),1,null)],1,null),e("div",null,{class:"opacity-0 group-hover:opacity-100 transition-opacity"},e("span",null,{class:"text-blue-500"},"‚ûú",3,null),3,null)],0,l.id)):e("div",null,{class:"text-center py-10 text-gray-400 text-sm"},"Nessun utente trovato",3,"je_1"),1,null),e("div",null,{class:"p-4 border-t border-gray-100 dark:border-gray-800 flex gap-3"},e("button",{onClick$:t.onClose$},{disabled:i(l=>l.value,[r]),class:"flex-1 px-4 py-3 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 font-bold rounded-xl hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},i(l=>l.value?"Invio in corso...":"Annulla",[r]),2,null),1,null)],1,null)],1,"je_2")},R=Object.freeze(Object.defineProperty({__proto__:null,s_Mn6LDBBEX0I:j},Symbol.toStringTag,{value:"Module"})),P=async(t,o)=>{const[n,r]=u();if(r.task){n.value=!0;try{const _=await(await fetch("/api/email/reminder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:t,title:`Sollecito: ${r.task.titolo}`,message:`Ciao ${o},

ti sollecito per il seguente task:

üìå ${r.task.titolo}
üìù ${r.task.contenuto||r.task.descrizione_breve||"Vedi dettagli in dashboard"}

Priorit√†: ${r.task.priorita.toUpperCase()}

Grazie per la collaborazione!`,actionUrl:`${window.location.origin}/gestione`,actionLabel:"Vai alla Dashboard"})})).json();_.success?(await g.collection("task_admin").update(r.task.id,{promemoria_inviato:!0,promemoria_data:new Date().toISOString()}),r.onSent$(),r.onClose$()):(console.error("Errore invio reminder:",_.error),alert("Errore durante l'invio del promemoria. Riprova."))}catch(a){console.error("Error sending reminder:",a),alert("Errore di connessione. Verifica la configurazione Email.")}finally{n.value=!1}}},E=Object.freeze(Object.defineProperty({__proto__:null,_hW:m,s_CttFvaEj9e0:P},Symbol.toStringTag,{value:"Module"}));export{m as _hW,R as r,k as s_9rGVhqV152A,P as s_CttFvaEj9e0,j as s_Mn6LDBBEX0I,y as s_QMOW0Dg8Hh4,O as s_c23VCCMQ7tY,M as s_r0HPMCmu084};
